<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>OpenWrt Wi-Fi Schedule | David Kennedy</title>
    

    <link href="/css/normalize.css" rel="stylesheet" />
    <link href="/css/base.css" rel="stylesheet" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <header>
      <div class="title">David Kennedy</div>

      <nav>
  <div>
    <a href="/">Home</a>
  </div>
  <div>
    <a href="/blog">Blog</a>
  </div>
  <div>
    <a href="/portfolio">Portfolio</a>
  </div>
  <div>
    <a href="/resume">Resume</a>
  </div>
  <div>
    <a href="/privacy">Privacy</a>
  </div>
  <div>
    <a href="/contact">Contact</a>
  </div>
</nav>


    </header>

    <div class="container">
      
<style>
  article .date, article .tags {
    margin-bottom: 1em;
    margin-top: 1em;
  }

  @media (min-width: 940px) {
    article .title {
      font-size: 3em; /* 60px */
      margin-bottom: 2em;
      margin-top: 2em;
      text-align: center;
    }

    .pagination {
      display: flex;
    }

    .pagination .previous {
      flex-basis: 50%;
      text-align: left;
    }

    .pagination .next {
      flex-basis: 50%;
      text-align: right;
    }
  }
</style>

<article>
  
    <h1 class="title">OpenWrt Wi-Fi Schedule</h1>
  

  

  
    <div class="date">March 07, 2023</div>
  

  

  
    <div class="tags">
      
        <a href="/blog/tags/computering">#Computering</a>
      
        <a href="/blog/tags/networking">#Networking</a>
      
        <a href="/blog/tags/openwrt">#OpenWrt</a>
      
    </div>
  

  <p>If I let them, my kids will stay up all night watching YouTube or TikTok or whatever. We have a no-devices-in-room policy, but disabling the wi-fi gives me a little more peace of mind.</p>
<p>Of course, I don't want to disable the wi-fi to <em>all</em> the devices in the house at bedtime. So I wrote this script:</p>
<pre><code>#!/usr/bin/env sh

if [ -z &quot;$1&quot; ]; then
    logger -st 'wifi-schedule' 'Missing argument'
    exit 1
fi

if [ &quot;$1&quot; != 'up' -a &quot;$1&quot; != 'down' ]; then
    logger -st 'wifi-schedule' &quot;Invalid argument: $1&quot;
    exit 1
fi

logger -st 'wifi-schedule' &quot;Toggling wifi schedule $1&quot;

add_mac() {
    if ! echo &quot;$1&quot; | grep -Eiq '^([a-f0-9]{2}:){5}[a-f0-9]{2}$'; then
        logger -st 'wifi-schedule' &quot;Invalid MAC address: $1&quot;
        return 1
    fi

    logger -st 'wifi-schedule' &quot;Adding MAC address: $1&quot;
    uci add_list wireless.@wifi-iface[0].maclist=&quot;$1&quot;
    uci add_list wireless.@wifi-iface[1].maclist=&quot;$1&quot;
}

# Remove all MAC addresses
sed -i '/list maclist/d' /etc/config/wireless

# Add unscheduled MAC addresses
add_mac 'a1:b2:c3:d4:e5:f6' # Laptop
add_mac 'aa:bb:cc:dd:ee:ff' # Phone

# Add scheduled MAC addresses if argument is &quot;up&quot;
if [ &quot;$1&quot; = 'up' ]; then
    add_mac '11:22:33:44:55:66' # Kids tablet
    add_mac '1a:2b:3c:4d:5e:6f' # Nintendo Switch
fi

uci commit wireless
wifi reload
</code></pre>
<p>Replace the MAC addresses and save the script at <code>/root/wifi-schedule.sh</code>. Then add this to <code>/etc/crontabs/root</code>:</p>
<pre><code>00 06 * * * /root/wifi-schedule.sh up
00 22 * * * /root/wifi-schedule.sh down
</code></pre>
<p>Adjust the on/off time as desired. Your kids will hate it.</p>
<p>Just remember to cancel their data plan.</p>

</article>




<div class="pagination">
  <div class="previous">
    
      <a href="/blog/posts/seamless-pane-window-switching-between-tmux-and-vim/">Â« Seamless Pane-Window Switching Between Tmux and Vim</a>
    
  </div>

  <div class="next">
    
  </div>
</div>


    </div>

    <footer>
      &copy; 2023
    </footer>
  </body>
</html>

